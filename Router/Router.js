"use strict";
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Router = void 0;
var Router_Config_1 = require("../Config/RouterConfig/Router.Config");
var Task_1 = require("../Task/Task");
var Utils_1 = require("../Utils/Utils");
var Router = (function () {
    function Router() {
    }
    Router.TryGetMapPath = function (name, CurrentPath, map) {
        for (var i = 0; i < map.length; i++) {
            var a = CurrentPath + "/" + (map[i].isDir ? Router_Config_1.DirectoryName[map[i].name] : Router_Config_1.PageName[map[i].name]);
            var Res = Router.TryGetMapPath(name, CurrentPath + "/" + (map[i].isDir ? Router_Config_1.DirectoryName[map[i].name] : Router_Config_1.PageName[map[i].name]), map[i].children);
            if (Res) {
                return Res;
            }
            if (map[i].name == name && !map[i].isDir) {
                return CurrentPath + "/" + (map[i].isDir ? Router_Config_1.DirectoryName[map[i].name] : Router_Config_1.PageName[map[i].name]) + "/" + Router_Config_1.PageName[map[i].name];
            }
        }
        return "";
    };
    Router.GetPagePath = function (name) {
        var Path = Router.TryGetMapPath(name, "/pages", Router_Config_1.PageMap);
        if (Path) {
            return Path;
        }
        else {
            return "/pages/" + Router_Config_1.PageName[name] + "/" + Router_Config_1.PageName[name];
        }
    };
    Router.PageLoad = function (page) {
        if (Router.WaitForBackTaskStacks.length > 0 && !Router.WaitForBackTaskStacks[Router.WaitForBackTaskStacks.length - 1].pageInstance) {
            Router.WaitForBackTaskStacks[Router.WaitForBackTaskStacks.length - 1].pageInstance = page;
        }
        Router.PageStacks.push(page);
        (0, Utils_1.Debug)(5)("PageLoaded", page);
    };
    Router.PageUnload = function () {
        var e_1, _a;
        var Observers = Router.RegisteredDataObservers.get(Router.CurrentPage);
        if (Observers) {
            try {
                for (var Observers_1 = __values(Observers), Observers_1_1 = Observers_1.next(); !Observers_1_1.done; Observers_1_1 = Observers_1.next()) {
                    var Notification = Observers_1_1.value;
                    Notification(Router.CurrentPage);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (Observers_1_1 && !Observers_1_1.done && (_a = Observers_1.return)) _a.call(Observers_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        var page = Router.PageStacks.pop();
        (0, Utils_1.Debug)(5)("PageUnload", page);
        if (page) {
            if (Router.WaitForBackTaskStacks[Router.WaitForBackTaskStacks.length - 1].pageInstance == page) {
                Router.WaitForBackTaskStacks[Router.WaitForBackTaskStacks.length - 1].task.Continue(Router.NavigatebackParam);
                Router.WaitForBackTaskStacks.pop();
            }
        }
        Router.NavigatebackParam = {};
    };
    Router.RegisterPageUnLoaded = function (page, notification) {
        var Observers = Router.RegisteredDataObservers.get(page);
        if (!Observers) {
            Observers = new Array();
        }
        Observers.push(notification);
        Router.RegisteredDataObservers.set(page, Observers);
    };
    Router.NavigateTo = function (name, param) {
        Router.NavigateParam = param ? param : undefined;
        wx.navigateTo({
            url: Router.GetPagePath(name)
        });
        var task = new Task_1.Task(function () { }, true);
        Router.WaitForBackTaskStacks.push({
            task: task,
            pageInstance: undefined
        });
        return task;
    };
    Router.NavigateBack = function (Param) {
        Router.NavigatebackParam = Param;
        wx.navigateBack();
    };
    Object.defineProperty(Router.prototype, "CurrentPage", {
        get: function () {
            return Router.PageStacks[Router.PageStacks.length - 1];
        },
        enumerable: false,
        configurable: true
    });
    Router.PageStacks = new Array();
    Router.RegisteredDataObservers = new Map();
    Router.WaitForBackTaskStacks = new Array();
    Router.NavigatebackParam = {};
    return Router;
}());
exports.Router = Router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUm91dGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUm91dGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0VBQXdGO0FBRXhGLHFDQUFvQztBQUNwQyx3Q0FBdUM7QUFjdkM7SUFBQTtJQWdHQSxDQUFDO0lBL0ZpQixvQkFBYSxHQUEzQixVQUE0QixJQUFjLEVBQUUsV0FBbUIsRUFBRSxHQUF1QjtRQUNwRixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsR0FBRyxXQUFXLEdBQUcsR0FBRyxHQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQSxDQUFDLENBQUEsNkJBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQyxDQUFBLHdCQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDM0YsSUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsV0FBVyxHQUFHLEdBQUcsR0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUEsQ0FBQyxDQUFBLDZCQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUMsQ0FBQSx3QkFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMxSSxJQUFJLEdBQUcsRUFBRTtnQkFDTCxPQUFPLEdBQUcsQ0FBQzthQUNkO1lBQ0QsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3RDLE9BQU8sV0FBVyxHQUFHLEdBQUcsR0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUEsQ0FBQyxDQUFBLDZCQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUMsQ0FBQSx3QkFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyx3QkFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUMzSDtTQUNKO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRWMsa0JBQVcsR0FBMUIsVUFBMkIsSUFBYztRQUNyQyxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsdUJBQU8sQ0FBQyxDQUFDO1FBQ3pELElBQUksSUFBSSxFQUFFO1lBQ04sT0FBTyxJQUFJLENBQUM7U0FDZjthQUFNO1lBQ0gsT0FBTyxTQUFTLEdBQUcsd0JBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsd0JBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUM1RDtJQUNMLENBQUM7SUFTYSxlQUFRLEdBQXRCLFVBQXVCLElBQW1CO1FBQ3RDLElBQUcsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sR0FBQyxDQUFDLElBQUUsQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLEVBQUM7WUFDeEgsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxHQUFDLElBQUksQ0FBQztTQUN6RjtRQUNELE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdCLElBQUEsYUFBSyxFQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksRUFBQyxJQUFJLENBQUMsQ0FBQTtJQUMvQixDQUFDO0lBR2EsaUJBQVUsR0FBeEI7O1FBQ0ksSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdkUsSUFBSSxTQUFTLEVBQUU7O2dCQUNYLEtBQXlCLElBQUEsY0FBQSxTQUFBLFNBQVMsQ0FBQSxvQ0FBQSwyREFBRTtvQkFBL0IsSUFBSSxZQUFZLHNCQUFBO29CQUNqQixZQUFZLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFBO2lCQUNuQzs7Ozs7Ozs7O1NBQ0o7UUFDRCxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ25DLElBQUEsYUFBSyxFQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksRUFBQyxJQUFJLENBQUMsQ0FBQTtRQUMzQixJQUFHLElBQUksRUFBQztZQUNKLElBQUcsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxJQUFFLElBQUksRUFBQztnQkFDdEYsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFDNUcsTUFBTSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsRUFBRSxDQUFDO2FBQ3RDO1NBQ0o7UUFDRCxNQUFNLENBQUMsaUJBQWlCLEdBQUMsRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFPYSwyQkFBb0IsR0FBbEMsVUFBbUMsSUFBbUIsRUFBQyxZQUEwQztRQUM3RixJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsdUJBQXVCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDWixTQUFTLEdBQUcsSUFBSSxLQUFLLEVBQWlDLENBQUM7U0FDMUQ7UUFDRCxTQUFTLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzdCLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFHYSxpQkFBVSxHQUF4QixVQUF5QixJQUFjLEVBQUUsS0FBVztRQUNoRCxNQUFNLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFakQsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNWLEdBQUcsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztTQUNoQyxDQUFDLENBQUM7UUFDSCxJQUFJLElBQUksR0FBRyxJQUFJLFdBQUksQ0FBQyxjQUFLLENBQUMsRUFBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDO1lBQzlCLElBQUksRUFBQyxJQUFJO1lBQ1QsWUFBWSxFQUFDLFNBQVM7U0FDekIsQ0FBQyxDQUFBO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVhLG1CQUFZLEdBQTFCLFVBQTJCLEtBQVU7UUFDakMsTUFBTSxDQUFDLGlCQUFpQixHQUFDLEtBQUssQ0FBQztRQUMvQixFQUFFLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUdELHNCQUFXLCtCQUFXO2FBQXRCO1lBQ0ksT0FBTyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzNELENBQUM7OztPQUFBO0lBdkVhLGlCQUFVLEdBQXlCLElBQUksS0FBSyxFQUFpQixDQUFDO0lBRTdELDhCQUF1QixHQUNoQyxJQUFJLEdBQUcsRUFBdUQsQ0FBQztJQUV0RCw0QkFBcUIsR0FBd0IsSUFBSSxLQUFLLEVBQW1CLENBQUM7SUFVM0Usd0JBQWlCLEdBQW9CLEVBQUUsQ0FBQztJQXlEMUQsYUFBQztDQUFBLEFBaEdELElBZ0dDO0FBaEdZLHdCQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZU5hbWUsIERpcmVjdG9yeU5hbWUsIFBhZ2VNYXAgfSBmcm9tIFwiLi4vQ29uZmlnL1JvdXRlckNvbmZpZy9Sb3V0ZXIuQ29uZmlnXCI7XHJcbmltcG9ydCB7IFNoaXlpUGFnZUJhc2UgfSBmcm9tIFwiLi4vU2hpeWlQYWdlL0Jhc2UvU2hpeWlQYWdlQmFzZVwiO1xyXG5pbXBvcnQgeyBUYXNrIH0gZnJvbSBcIi4uL1Rhc2svVGFza1wiO1xyXG5pbXBvcnQgeyBEZWJ1ZyB9IGZyb20gXCIuLi9VdGlscy9VdGlsc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGFnZU1hcEl0ZW0ge1xyXG4gICAgbmFtZTogUGFnZU5hbWV8RGlyZWN0b3J5TmFtZSxcclxuICAgIGNoaWxkcmVuOiBBcnJheTxQYWdlTWFwSXRlbT4sXHJcbiAgICBpc0Rpcj86Ym9vbGVhbixcclxufVxyXG5cclxuaW50ZXJmYWNlIFdhaXRGb3JCYWNrVGFza3tcclxuICAgIHRhc2s6VGFzazxhbnk+LFxyXG4gICAgcGFnZUluc3RhbmNlOlNoaXlpUGFnZUJhc2V8dW5kZWZpbmVkXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBSb3V0ZXIge1xyXG4gICAgcHVibGljIHN0YXRpYyBUcnlHZXRNYXBQYXRoKG5hbWU6IFBhZ2VOYW1lLCBDdXJyZW50UGF0aDogc3RyaW5nLCBtYXA6IEFycmF5PFBhZ2VNYXBJdGVtPik6IHN0cmluZyB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGEgPSBDdXJyZW50UGF0aCArIFwiL1wiICsobWFwW2ldLmlzRGlyP0RpcmVjdG9yeU5hbWVbbWFwW2ldLm5hbWVdOlBhZ2VOYW1lW21hcFtpXS5uYW1lXSk7XHJcbiAgICAgICAgICAgIGxldCBSZXMgPSBSb3V0ZXIuVHJ5R2V0TWFwUGF0aChuYW1lLCBDdXJyZW50UGF0aCArIFwiL1wiICsobWFwW2ldLmlzRGlyP0RpcmVjdG9yeU5hbWVbbWFwW2ldLm5hbWVdOlBhZ2VOYW1lW21hcFtpXS5uYW1lXSksIG1hcFtpXS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgIGlmIChSZXMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBSZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1hcFtpXS5uYW1lID09IG5hbWUgJiYgIW1hcFtpXS5pc0Rpcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEN1cnJlbnRQYXRoICsgXCIvXCIgKyhtYXBbaV0uaXNEaXI/RGlyZWN0b3J5TmFtZVttYXBbaV0ubmFtZV06UGFnZU5hbWVbbWFwW2ldLm5hbWVdKSArIFwiL1wiICsgUGFnZU5hbWVbbWFwW2ldLm5hbWVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIEdldFBhZ2VQYXRoKG5hbWU6IFBhZ2VOYW1lKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgUGF0aCA9IFJvdXRlci5UcnlHZXRNYXBQYXRoKG5hbWUsIFwiL3BhZ2VzXCIsIFBhZ2VNYXApO1xyXG4gICAgICAgIGlmIChQYXRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQYXRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIi9wYWdlcy9cIiArIFBhZ2VOYW1lW25hbWVdICsgXCIvXCIgKyBQYWdlTmFtZVtuYW1lXTtcclxuICAgICAgICB9IFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgUGFnZVN0YWNrczogQXJyYXk8U2hpeWlQYWdlQmFzZT4gPSBuZXcgQXJyYXk8U2hpeWlQYWdlQmFzZT4oKTtcclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBSZWdpc3RlcmVkRGF0YU9ic2VydmVyczogTWFwPFNoaXlpUGFnZUJhc2UsIEFycmF5PChwYWdlOiBTaGl5aVBhZ2VCYXNlKSA9PiB2b2lkPj5cclxuICAgICAgICA9IG5ldyBNYXA8U2hpeWlQYWdlQmFzZSwgQXJyYXk8KHBhZ2U6IFNoaXlpUGFnZUJhc2UpID0+IHZvaWQ+PigpO1xyXG4gICAgXHJcbiAgICBwcml2YXRlIHN0YXRpYyBXYWl0Rm9yQmFja1Rhc2tTdGFja3M6QXJyYXk8V2FpdEZvckJhY2tUYXNrPj1uZXcgQXJyYXk8V2FpdEZvckJhY2tUYXNrPigpO1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgUGFnZUxvYWQocGFnZTogU2hpeWlQYWdlQmFzZSk6IHZvaWQge1xyXG4gICAgICAgIGlmKFJvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3MubGVuZ3RoPjAmJiFSb3V0ZXIuV2FpdEZvckJhY2tUYXNrU3RhY2tzW1JvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3MubGVuZ3RoLTFdLnBhZ2VJbnN0YW5jZSl7XHJcbiAgICAgICAgICAgIFJvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3NbUm91dGVyLldhaXRGb3JCYWNrVGFza1N0YWNrcy5sZW5ndGgtMV0ucGFnZUluc3RhbmNlPXBhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFJvdXRlci5QYWdlU3RhY2tzLnB1c2gocGFnZSk7XHJcbiAgICAgICAgRGVidWcoNSkoXCJQYWdlTG9hZGVkXCIscGFnZSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIE5hdmlnYXRlYmFja1BhcmFtOlJlY29yZDxzdHJpbmcsYW55Pj17fTtcclxuICAgIHB1YmxpYyBzdGF0aWMgUGFnZVVubG9hZCgpOiB2b2lkIHtcclxuICAgICAgICBsZXQgT2JzZXJ2ZXJzID0gUm91dGVyLlJlZ2lzdGVyZWREYXRhT2JzZXJ2ZXJzLmdldChSb3V0ZXIuQ3VycmVudFBhZ2UpO1xyXG4gICAgICAgIGlmIChPYnNlcnZlcnMpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgTm90aWZpY2F0aW9uIG9mIE9ic2VydmVycykge1xyXG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uKFJvdXRlci5DdXJyZW50UGFnZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcGFnZSA9IFJvdXRlci5QYWdlU3RhY2tzLnBvcCgpO1xyXG4gICAgICAgIERlYnVnKDUpKFwiUGFnZVVubG9hZFwiLHBhZ2UpXHJcbiAgICAgICAgaWYocGFnZSl7XHJcbiAgICAgICAgICAgIGlmKFJvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3NbUm91dGVyLldhaXRGb3JCYWNrVGFza1N0YWNrcy5sZW5ndGgtMV0ucGFnZUluc3RhbmNlPT1wYWdlKXtcclxuICAgICAgICAgICAgICAgIFJvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3NbUm91dGVyLldhaXRGb3JCYWNrVGFza1N0YWNrcy5sZW5ndGgtMV0udGFzay5Db250aW51ZShSb3V0ZXIuTmF2aWdhdGViYWNrUGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgUm91dGVyLldhaXRGb3JCYWNrVGFza1N0YWNrcy5wb3AoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBSb3V0ZXIuTmF2aWdhdGViYWNrUGFyYW09e307XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnu5HlrprmjIflrprpobXpnaJVbmxvYWRlZOS6i+S7tlxyXG4gICAgICogQHBhcmFtIHBhZ2Ug6KaB57uR5a6a55qE6aG16Z2iXHJcbiAgICAgKiBAcGFyYW0gbm90aWZpY2F0aW9uIFVubG9hZOaXtuWkhOeQhuWHveaVsFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIFJlZ2lzdGVyUGFnZVVuTG9hZGVkKHBhZ2U6IFNoaXlpUGFnZUJhc2Usbm90aWZpY2F0aW9uOihwYWdlOiBTaGl5aVBhZ2VCYXNlKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IE9ic2VydmVycyA9IFJvdXRlci5SZWdpc3RlcmVkRGF0YU9ic2VydmVycy5nZXQocGFnZSk7XHJcbiAgICAgICAgaWYgKCFPYnNlcnZlcnMpIHtcclxuICAgICAgICAgICAgT2JzZXJ2ZXJzID0gbmV3IEFycmF5PChwYWdlOiBTaGl5aVBhZ2VCYXNlKSA9PiB2b2lkPigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYnNlcnZlcnMucHVzaChub3RpZmljYXRpb24pO1xyXG4gICAgICAgIFJvdXRlci5SZWdpc3RlcmVkRGF0YU9ic2VydmVycy5zZXQocGFnZSwgT2JzZXJ2ZXJzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIE5hdmlnYXRlUGFyYW06IGFueVxyXG4gICAgcHVibGljIHN0YXRpYyBOYXZpZ2F0ZVRvKG5hbWU6IFBhZ2VOYW1lLCBwYXJhbT86IGFueSk6IFRhc2s8YW55PiB7XHJcbiAgICAgICAgUm91dGVyLk5hdmlnYXRlUGFyYW0gPSBwYXJhbSA/IHBhcmFtIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xyXG4gICAgICAgICAgICB1cmw6IFJvdXRlci5HZXRQYWdlUGF0aChuYW1lKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCB0YXNrID0gbmV3IFRhc2soKCk9Pnt9LHRydWUpO1xyXG4gICAgICAgIFJvdXRlci5XYWl0Rm9yQmFja1Rhc2tTdGFja3MucHVzaCh7XHJcbiAgICAgICAgICAgIHRhc2s6dGFzayxcclxuICAgICAgICAgICAgcGFnZUluc3RhbmNlOnVuZGVmaW5lZFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHRhc2s7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBOYXZpZ2F0ZUJhY2soUGFyYW0/OmFueSkge1xyXG4gICAgICAgIFJvdXRlci5OYXZpZ2F0ZWJhY2tQYXJhbT1QYXJhbTtcclxuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEN1cnJlbnRQYWdlOiBTaGl5aVBhZ2VCYXNlO1xyXG4gICAgcHVibGljIGdldCBDdXJyZW50UGFnZSgpOiBTaGl5aVBhZ2VCYXNlIHtcclxuICAgICAgICByZXR1cm4gUm91dGVyLlBhZ2VTdGFja3NbUm91dGVyLlBhZ2VTdGFja3MubGVuZ3RoIC0gMV07XHJcbiAgICB9XHJcbn1cclxuIl19