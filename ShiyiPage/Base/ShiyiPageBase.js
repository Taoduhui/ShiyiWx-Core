"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ShiyiPageBase = exports.ShiyiPageUIBase = exports.ShiyiPageFuncBase = void 0;
var Router_1 = require("../../Router/Router");
var GlobalData_1 = require("../../../GlobalData/GlobalData");
var ShiyiPageExternBase = (function () {
    function ShiyiPageExternBase() {
    }
    Object.defineProperty(ShiyiPageExternBase.prototype, "Inst", {
        get: function () {
            return this.PageInstance;
        },
        enumerable: false,
        configurable: true
    });
    ShiyiPageExternBase.prototype.Init = function () {
        this._Render = this.PageInstance.Render.bind(this.PageInstance);
        this.data = this.PageInstance.data;
        return this;
    };
    ShiyiPageExternBase.prototype.Render = function (value) {
        this._Render(value);
    };
    return ShiyiPageExternBase;
}());
var ShiyiPageFuncBase = (function (_super) {
    __extends(ShiyiPageFuncBase, _super);
    function ShiyiPageFuncBase() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ShiyiPageFuncBase;
}(ShiyiPageExternBase));
exports.ShiyiPageFuncBase = ShiyiPageFuncBase;
var ShiyiPageUIBase = (function (_super) {
    __extends(ShiyiPageUIBase, _super);
    function ShiyiPageUIBase() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ShiyiPageUIBase.prototype.Init = function () {
        _super.prototype.Init.call(this);
        this.LoadGlobalUIConfig();
        return this;
    };
    ShiyiPageUIBase.prototype.LoadGlobalUIConfig = function () {
        this.PageInstance.BindGlobal(GlobalData_1.GlobalData.Theme, "Theme", function (value) {
            return value ? "Boy" : "Girl";
        });
    };
    return ShiyiPageUIBase;
}(ShiyiPageExternBase));
exports.ShiyiPageUIBase = ShiyiPageUIBase;
var ShiyiPageBase = (function () {
    function ShiyiPageBase() {
        this.RegisteredEventHandlers = {};
        this.ObserverList = {};
        this.RegisteredGlobalBackWardBinding = {};
        this.RegisteredSelfBinding = {};
        this.ComponentDataKeyPair = {};
    }
    ShiyiPageBase.prototype.BindEvent = function (Trigger, Handler) {
        this.AddHandler(Trigger, Handler);
    };
    ShiyiPageBase.prototype.AddHandler = function (Trigger, Handler) {
        this.RegisteredEventHandlers[Trigger] = Handler;
    };
    ShiyiPageBase.prototype.Removehandler = function (Trigger, Handler) {
        if (this.RegisteredEventHandlers[Trigger] === Handler) {
            delete this.RegisteredEventHandlers[Trigger];
        }
    };
    ShiyiPageBase.prototype.EventHandler = function (e) {
        e.Catch();
        var Handler = this.RegisteredEventHandlers[e.EventName];
        console.log(Handler);
        if (Handler) {
            Handler(e);
        }
        else {
            e.Pass();
        }
    };
    ShiyiPageBase.prototype.AddObserver = function (data, target) {
        this.ObserverList[data.DataKey] = target;
        data.Bind(this);
    };
    ShiyiPageBase.prototype.RemoveObserver = function (data) {
        if (this.ObserverList[data.DataKey]) {
            delete this.ObserverList[data.DataKey];
        }
    };
    ShiyiPageBase.prototype.ObserverNotify = function (key, value) {
        var _a;
        var target = this.ObserverList[key];
        if (target) {
            this.RenderNoBackward((_a = {},
                _a[target.name] = target.PreProcess ? target.PreProcess(value) : value,
                _a));
        }
    };
    ShiyiPageBase.prototype.BindGlobal = function (GlobalData, SelfDataKey, PreProcess) {
        this.AddObserver(GlobalData, {
            name: SelfDataKey,
            PreProcess: PreProcess
        });
    };
    ShiyiPageBase.prototype.BindGlobalBackward = function (SelfDataKey, GlobalDataObj, PreProcess) {
        if (!this.RegisteredGlobalBackWardBinding[SelfDataKey]) {
            this.RegisteredGlobalBackWardBinding[SelfDataKey] = new Array();
        }
        this.RegisteredGlobalBackWardBinding[SelfDataKey].push({
            "TargetDataObj": GlobalDataObj,
            "PreProcess": PreProcess
        });
    };
    ShiyiPageBase.prototype.BindGlobalTwoWay = function (SelfDataKey, GlobalDataObj, SelfToGlobalPreProcess, GlobalToSelfPreProcess) {
        this.BindGlobal(GlobalDataObj, SelfDataKey, GlobalToSelfPreProcess);
        this.BindGlobalBackward(SelfDataKey, GlobalDataObj, SelfToGlobalPreProcess);
    };
    ShiyiPageBase.prototype.BindSelf = function (SrcKey, TargetKey, PreProcess) {
        if (!this.RegisteredSelfBinding[SrcKey]) {
            this.RegisteredSelfBinding[SrcKey] = new Array();
        }
        this.RegisteredSelfBinding[SrcKey].push({
            name: TargetKey,
            PreProcess: PreProcess
        });
        var RenderData = {};
        RenderData[SrcKey] = this.data[SrcKey];
        this.Render(RenderData);
    };
    ShiyiPageBase.prototype.BindSelfTwoWay = function (FirstData, SecData, FirstToSecPreProcess, SecToFirstPreProcess) {
        this.BindSelf(FirstData, SecData, FirstToSecPreProcess);
        this.BindSelf(SecData, FirstData, SecToFirstPreProcess);
    };
    ShiyiPageBase.prototype.Render = function (value) {
        this._render(value, false);
    };
    ShiyiPageBase.prototype.RenderNoBackward = function (value) {
        this._render(value, true);
    };
    ShiyiPageBase.prototype._render = function (value, DisableBackward) {
        var _this = this;
        var Modified = false;
        var Keys = Object.keys(value);
        Keys.forEach(function (key) {
            if (_this.ComponentDataKeyPair[key]) {
                _this.ComponentDataKeyPair[key].CompInst.data[_this.ComponentDataKeyPair[key].key] = value[key];
            }
            if (_this.RegisteredSelfBinding[key]) {
                _this.RegisteredSelfBinding[key].forEach(function (target) {
                    if (Keys.indexOf(target.name) < 0) {
                        Modified = true;
                        if (target.PreProcess) {
                            value[target.name] = target.PreProcess(value[key]);
                        }
                        else {
                            value[target.name] = value[key];
                        }
                    }
                });
            }
            if (!DisableBackward && _this.RegisteredGlobalBackWardBinding[key]) {
                _this.RegisteredGlobalBackWardBinding[key].forEach(function (target) {
                    target.TargetDataObj.Set(target.PreProcess ?
                        target.PreProcess(value[key]) :
                        value[key]);
                });
            }
        });
        if (Modified) {
            this._render(value, DisableBackward);
            return;
        }
        this.setData(value);
    };
    ShiyiPageBase.prototype.LoadPesudoComponents = function () {
        var _this = this;
        var BaseFunctions = Object.keys(this);
        var components = this.PesudoCompnents;
        Object.keys(components).forEach(function (key) {
            var Comp = components[key];
            Comp.PageInstance = _this;
            Comp._render = _this.Render.bind(_this);
            var CompProto = Comp;
            var CompId = components[key].ComponentId;
            while (CompProto) {
                Object.keys(CompProto).forEach(function (key) {
                    if (typeof CompProto[key] == "function") {
                        _this[CompId + key] = CompProto[key].bind(Comp);
                    }
                });
                CompProto = Object.getPrototypeOf(CompProto);
            }
            var CompData = {};
            var MappingCompData = {};
            Object.keys(components[key].data).forEach(function (datakey) {
                CompData[CompId + datakey] = components[key].data[datakey];
                _this.ComponentDataKeyPair[CompId + datakey] = {
                    key: datakey,
                    CompInst: components[key]
                };
            });
            _this.Render(CompData);
            Comp.Init();
        });
    };
    ShiyiPageBase.prototype.DataChange = function (e) {
        var model = e;
        var path = model.currentTarget.dataset.key.split(".");
        var data = {};
        var root = data;
        for (var i = 0; i < path.length; i++) {
            if (i == path.length - 1) {
                data[path[i]] = model.detail.value;
                continue;
            }
            if (typeof data[path[i]] == "number") {
                data[path[i]] = Number(this.data[path[i]]);
            }
            else {
                data[path[i]] = this.data[path[i]];
            }
            data = data[path[i]];
        }
        this.Render(root);
    };
    ShiyiPageBase.prototype.LoadExtends = function () {
        this.Func.PageInstance = this;
        this.Func.Init();
        this.UI.PageInstance = this;
        this.UI.Init();
        this.UI.InitCustomData();
        this.Func.InitCustomData();
    };
    ShiyiPageBase.prototype.onLoad = function () {
        this.InParameter = Router_1.Router.NavigateParam;
        Router_1.Router.PageLoad(this);
        if (this.Loaded) {
            this.Loaded();
        }
        this.LoadPesudoComponents();
        this.LoadExtends();
    };
    ShiyiPageBase.prototype.onUnload = function () {
        Router_1.Router.PageUnload();
    };
    return ShiyiPageBase;
}());
exports.ShiyiPageBase = ShiyiPageBase;
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hpeWlQYWdlQmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlNoaXlpUGFnZUJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsOENBQTZDO0FBRTdDLDZEQUE0RDtBQU81RDtJQU9JO0lBQ0EsQ0FBQztJQU5ELHNCQUFXLHFDQUFJO2FBQWY7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDN0IsQ0FBQzs7O09BQUE7SUFNTSxrQ0FBSSxHQUFYO1FBQ0ksSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7UUFDbkMsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUdNLG9DQUFNLEdBQWIsVUFBa0MsS0FBb0M7UUFDbEUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBQ0wsMEJBQUM7QUFBRCxDQUFDLEFBcEJELElBb0JDO0FBRUQ7SUFBNkUscUNBQTBCO0lBQXZHOztJQUNBLENBQUM7SUFBRCx3QkFBQztBQUFELENBQUMsQUFERCxDQUE2RSxtQkFBbUIsR0FDL0Y7QUFEcUIsOENBQWlCO0FBR3ZDO0lBQTJFLG1DQUEwQjtJQUFyRzs7SUFhQSxDQUFDO0lBWlUsOEJBQUksR0FBWDtRQUNJLGlCQUFNLElBQUksV0FBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDMUIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNNLDRDQUFrQixHQUF6QjtRQUNJLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLHVCQUFVLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFDbEQsVUFBQyxLQUFjO1lBQ1gsT0FBTyxLQUFLLENBQUMs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LENBQUM7U0FDdEI7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFFUyxtQ0FBVyxHQUFyQjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUM1QixJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFJTSw4QkFBTSxHQUFiO1FBQ0ksSUFBSSxDQUFDLFdBQVcsR0FBRyxlQUFNLENBQUMsYUFBYSxDQUFDO1FBQ3hDLGVBQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ2pCO1FBQ0QsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFTSxnQ0FBUSxHQUFmO1FBQ0ksZUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFDTCxvQkFBQztBQUFELENBQUMsQUFsVEQsSUFrVEM7QUFsVHFCLHNDQUFhO0FBa1RsQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnQgfSBmcm9tIFwiLi4vLi4vRXZlbnQvRXZlbnRcIjtcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSBcIi4uLy4uL1JvdXRlci9Sb3V0ZXJcIjtcclxuaW1wb3J0IHsgRGF0YSB9IGZyb20gXCIuLi8uLi9EYXRhL0RhdGFcIjtcclxuaW1wb3J0IHsgR2xvYmFsRGF0YSB9IGZyb20gXCIuLi8uLi8uLi9HbG9iYWxEYXRhL0dsb2JhbERhdGFcIjtcclxuaW1wb3J0IHsgUGVzdWRvQ29tcG5lbnQgfSBmcm9tIFwiLi4vLi4vU2hpeWlQZXN1ZG9Db21wbmVudC9QZXN1ZG9Db21wbmVudFwiO1xyXG5pbXBvcnQgeyBEYXRhQ2hhbmdlT3B0aW9uIH0gZnJvbSBcIi4uLy4uL1VJL01vZGVsL0RhdGFDaGFuZ2VNb2RlbC9EYXRhQ2hhbmdlTW9kZWxcIjtcclxuaW1wb3J0IHsgSXVpT3B0aW9uIH0gZnJvbSBcIi4uLy4uL1VJL01vZGVsL0l1aU9wdGlvblwiO1xyXG5pbXBvcnQgeyBDdXN0b21HbG9iYWxQYWdlRGF0YSB9IGZyb20gXCIuLi8uLi9Db25maWcvU2hpeWlQYWdlQ29uZmlnL1NoaXlpUGFnZS5Db25maWdcIjtcclxuXHJcblxyXG5hYnN0cmFjdCBjbGFzcyBTaGl5aVBhZ2VFeHRlcm5CYXNlPFBhZ2VUIGV4dGVuZHMgU2hpeWlQYWdlQmFzZT4ge1xyXG4gICAgcHVibGljIFBhZ2VJbnN0YW5jZSE6IFBhZ2VUXHJcbiAgICBwdWJsaWMgZ2V0IEluc3QoKTogUGFnZVQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLlBhZ2VJbnN0YW5jZTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBfUmVuZGVyITogKHZhbHVlOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiB2b2lkO1xyXG4gICAgcHVibGljIGRhdGEhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIEluaXQoKTogU2hpeWlQYWdlRXh0ZXJuQmFzZTxQYWdlVD4ge1xyXG4gICAgICAgIHRoaXMuX1JlbmRlciA9IHRoaXMuUGFnZUluc3RhbmNlLlJlbmRlci5iaW5kKHRoaXMuUGFnZUluc3RhbmNlKTtcclxuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLlBhZ2VJbnN0YW5jZS5kYXRhO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGFic3RyYWN0IEluaXRDdXN0b21EYXRhKF9vcHRpb25zPzogUmVjb3JkPHN0cmluZywgYW55PiB8IHVuZGVmaW5lZCk6IHZvaWQ7XHJcblxyXG4gICAgcHVibGljIFJlbmRlcjxUIGV4dGVuZHMgUGFnZURhdGE+KHZhbHVlOiBQYXJ0aWFsPFJlY29yZDxrZXlvZiBULCBhbnk+Pik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX1JlbmRlcih2YWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBTaGl5aVBhZ2VGdW5jQmFzZTxQYWdlVCBleHRlbmRzIFNoaXlpUGFnZUJhc2U+IGV4dGVuZHMgU2hpeWlQYWdlRXh0ZXJuQmFzZTxQYWdlVD4ge1xyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU2hpeWlQYWdlVUlCYXNlPFBhZ2VUIGV4dGVuZHMgU2hpeWlQYWdlQmFzZT4gZXh0ZW5kcyBTaGl5aVBhZ2VFeHRlcm5CYXNlPFBhZ2VUPiB7XHJcbiAgICBwdWJsaWMgSW5pdCgpOiBTaGl5aVBhZ2VFeHRlcm5CYXNlPFBhZ2VUPiB7XHJcbiAgICAgICAgc3VwZXIuSW5pdCgpO1xyXG4gICAgICAgIHRoaXMuTG9hZEdsb2JhbFVJQ29uZmlnKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgTG9hZEdsb2JhbFVJQ29uZmlnKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuUGFnZUluc3RhbmNlLkJpbmRHbG9iYWwoR2xvYmFsRGF0YS5UaGVtZSwgXCJUaGVtZVwiLFxyXG4gICAgICAgICAgICAodmFsdWU6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IFwiQm95XCIgOiBcIkdpcmxcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQYWdlRGF0YSBleHRlbmRzIEN1c3RvbUdsb2JhbFBhZ2VEYXRhIHtcclxuICAgIFxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBlc3Vkb0NvbXBuZW50U3RhY2sge1xyXG5cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTaGl5aVBhZ2VCYXNlIGV4dGVuZHMgV2VjaGF0TWluaXByb2dyYW0uUGFnZS5JbnN0YW5jZU1ldGhvZHM8V2VjaGF0TWluaXByb2dyYW0uQ29tcG9uZW50LkRhdGFPcHRpb24+IHtcclxuXHJcbn1cclxuXHJcbmludGVyZmFjZSBPYnNlcnZlclRhcmdldDxEYXRhVD4ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgUHJlUHJvY2Vzcz86ICh2YWx1ZTogRGF0YVQpID0+IGFueTtcclxufVxyXG5cclxuaW50ZXJmYWNlIE9ic2VydmVyQmFja3dhcmRUYXJnZXQ8RGF0YVQ+IHtcclxuICAgIFRhcmdldERhdGFPYmo6IERhdGE8YW55PjtcclxuICAgIFByZVByb2Nlc3M/OiAodmFsdWU6IERhdGFUKSA9PiBhbnk7XHJcbn1cclxuXHJcblxyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFNoaXlpUGFnZUJhc2VcclxuICAgIGltcGxlbWVudHMgV2VjaGF0TWluaXByb2dyYW0uUGFnZS5PcHRpb25zPFxyXG4gICAgV2VjaGF0TWluaXByb2dyYW0uUGFnZS5EYXRhT3B0aW9uLFxyXG4gICAgV2VjaGF0TWluaXByb2dyYW0uUGFnZS5DdXN0b21PcHRpb25cclxuICAgID57XHJcbiAgICBwdWJsaWMgZGF0YSE6IFBhZ2VEYXRhO1xyXG4gICAgcHVibGljIEZ1bmMhOiBTaGl5aVBhZ2VFeHRlcm5CYXNlPFNoaXlpUGFnZUJhc2U+O1xyXG4gICAgcHVibGljIFVJITogU2hpeWlQYWdlRXh0ZXJuQmFzZTxTaGl5aVBhZ2VCYXNlPjtcclxuICAgIC8vI3JlZ2lvbiDkuovku7blpITnkIZcclxuICAgIHB1YmxpYyBSZWdpc3RlcmVkRXZlbnRIYW5kbGVyczogUmVjb3JkPHN0cmluZywgKGU6IEV2ZW50KSA9PiB2b2lkPiA9IHt9O1xyXG4gICAgcHVibGljIFBlc3Vkb0NvbXBuZW50cyE6IFBlc3Vkb0NvbXBuZW50U3RhY2s7XHJcbiAgICBwcm90ZWN0ZWQgTG9hZGVkPzogKCkgPT4gdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog57uR5a6a5LqL5Lu25aSE55CG5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gVHJpZ2dlciDkuovku7blkI1cclxuICAgICAqIEBwYXJhbSBIYW5kbGVyIOWkhOeQhuaWueazlVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgQmluZEV2ZW50KFRyaWdnZXI6IHN0cmluZywgSGFuZGxlcjogKGU6IEV2ZW50KSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5BZGRIYW5kbGVyKFRyaWdnZXIsIEhhbmRsZXIpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIEFkZEhhbmRsZXIoVHJpZ2dlcjogc3RyaW5nLCBIYW5kbGVyOiAoZTogRXZlbnQpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLlJlZ2lzdGVyZWRFdmVudEhhbmRsZXJzW1RyaWdnZXJdID0gSGFuZGxlcjtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZW1vdmVoYW5kbGVyKFRyaWdnZXI6IHN0cmluZywgSGFuZGxlcjogKGU6IEV2ZW50KSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuUmVnaXN0ZXJlZEV2ZW50SGFuZGxlcnNbVHJpZ2dlcl0gPT09IEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuUmVnaXN0ZXJlZEV2ZW50SGFuZGxlcnNbVHJpZ2dlcl07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBFdmVudEhhbmRsZXIoZTogRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBlLkNhdGNoKCk7XHJcbiAgICAgICAgbGV0IEhhbmRsZXIgPSB0aGlzLlJlZ2lzdGVyZWRFdmVudEhhbmRsZXJzW2UuRXZlbnROYW1lXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhIYW5kbGVyKTtcclxuICAgICAgICBpZiAoSGFuZGxlcikge1xyXG4gICAgICAgICAgICBIYW5kbGVyKGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGUuUGFzcygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiDmlbDmja7nu5HlrppcclxuICAgIHByaXZhdGUgT2JzZXJ2ZXJMaXN0OiBSZWNvcmQ8c3RyaW5nLCBPYnNlcnZlclRhcmdldDxhbnk+PiA9IHt9O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhajlsYDmlbDmja7nu5HlrppcclxuICAgICAqIEBwYXJhbSBkYXRhIOe7keWumuaVsOaNrua6kFxyXG4gICAgICogQHBhcmFtIHRhcmdldCDnu5HlrprmnKzpobXpnaLnmoTmlbDmja5cclxuICAgICAqL1xyXG4gICAgcHVibGljIEFkZE9ic2VydmVyPERhdGFUPihkYXRhOiBEYXRhPERhdGFUPiwgdGFyZ2V0OiBPYnNlcnZlclRhcmdldDxEYXRhVD4pIHtcclxuICAgICAgICB0aGlzLk9ic2VydmVyTGlzdFtkYXRhLkRhdGFLZXldID0gdGFyZ2V0O1xyXG4gICAgICAgIGRhdGEuQmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgUmVtb3ZlT2JzZXJ2ZXI8RGF0YVQ+KGRhdGE6IERhdGE8RGF0YVQ+KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuT2JzZXJ2ZXJMaXN0W2RhdGEuRGF0YUtleV0pIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuT2JzZXJ2ZXJMaXN0W2RhdGEuRGF0YUtleV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBPYnNlcnZlck5vdGlmeShrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLk9ic2VydmVyTGlzdFtrZXldO1xyXG4gICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgdGhpcy5SZW5kZXJOb0JhY2t3YXJkKHtcclxuICAgICAgICAgICAgICAgIFt0YXJnZXQubmFtZV06IHRhcmdldC5QcmVQcm9jZXNzID8gdGFyZ2V0LlByZVByb2Nlc3ModmFsdWUpIDogdmFsdWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFqOWxgOaVsOaNrue7keWumlxyXG4gICAgICogQHR5cGUge0dsb2JhbERhdGFUfSDlhajlsYDmlbDmja7nsbvlnotcclxuICAgICAqIEB0eXBlIHtUfSDpobXpnaLkuK3mtL7nlJ/oh6pQYWdlRGF0YeeahGRhdGHnsbvlnotcclxuICAgICAqIEBwYXJhbSBHbG9iYWxEYXRhIOWFqOWxgOaVsOaNrk9iamVjdFxyXG4gICAgICogQHBhcmFtIFNlbGZEYXRhS2V5IOiHqui6q+aVsOaNrktleVxyXG4gICAgICogQHBhcmFtIFByZVByb2Nlc3Mg6aKE5aSE55CG5pa55byPXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBCaW5kR2xvYmFsPEdsb2JhbERhdGFULCBUIGV4dGVuZHMgUGFnZURhdGE+KFxyXG4gICAgICAgIEdsb2JhbERhdGE6IERhdGE8R2xvYmFsRGF0YVQ+LFxyXG4gICAgICAgIFNlbGZEYXRhS2V5OiBrZXlvZiBULFxyXG4gICAgICAgIFByZVByb2Nlc3M/OiAodmFsdWU6IEdsb2JhbERhdGFUKSA9PiBhbnkpIHtcclxuICAgICAgICB0aGlzLkFkZE9ic2VydmVyPEdsb2JhbERhdGFUPihHbG9iYWxEYXRhLCB7XHJcbiAgICAgICAgICAgIG5hbWU6IFNlbGZEYXRhS2V5IGFzIHN0cmluZyxcclxuICAgICAgICAgICAgUHJlUHJvY2VzczogUHJlUHJvY2Vzc1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBSZWdpc3RlcmVkR2xvYmFsQmFja1dhcmRCaW5kaW5nOiBSZWNvcmQ8c3RyaW5nLCBBcnJheTxPYnNlcnZlckJhY2t3YXJkVGFyZ2V0PGFueT4+PiA9IHt9O1xyXG5cclxuICAgIHB1YmxpYyBCaW5kR2xvYmFsQmFja3dhcmQ8U2VsZkRhdGFULCBUIGV4dGVuZHMgUGFnZURhdGE+KFxyXG4gICAgICAgIFNlbGZEYXRhS2V5OiBrZXlvZiBULFxyXG4gICAgICAgIEdsb2JhbERhdGFPYmo6IERhdGE8YW55PixcclxuICAgICAgICBQcmVQcm9jZXNzPzogKHZhbHVlOiBTZWxmRGF0YVQpID0+IGFueSkge1xyXG4gICAgICAgIGlmICghdGhpcy5SZWdpc3RlcmVkR2xvYmFsQmFja1dhcmRCaW5kaW5nW1NlbGZEYXRhS2V5IGFzIHN0cmluZ10pIHtcclxuICAgICAgICAgICAgdGhpcy5SZWdpc3RlcmVkR2xvYmFsQmFja1dhcmRCaW5kaW5nW1NlbGZEYXRhS2V5IGFzIHN0cmluZ10gPSBuZXcgQXJyYXk8T2JzZXJ2ZXJCYWNrd2FyZFRhcmdldDxhbnk+PigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLlJlZ2lzdGVyZWRHbG9iYWxCYWNrV2FyZEJpbmRpbmdbU2VsZkRhdGFLZXkgYXMgc3RyaW5nXS5wdXNoKHtcclxuICAgICAgICAgICAgXCJUYXJnZXREYXRhT2JqXCI6IEdsb2JhbERhdGFPYmosXHJcbiAgICAgICAgICAgIFwiUHJlUHJvY2Vzc1wiOiBQcmVQcm9jZXNzXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajlsYDmlbDmja7lj4zlkJHnu5HlrppcclxuICAgICAqIEBwYXJhbSBTZWxmRGF0YUtleSDoh6rouqvmlbDmja5LZXlcclxuICAgICAqIEBwYXJhbSBHbG9iYWxEYXRhT2JqIOWFqOWxgOaVsOaNrk9iamVjdFxyXG4gICAgICogQHBhcmFtIFNlbGZUb0dsb2JhbFByZVByb2Nlc3Mg6Ieq6Lqr5pWw5o2u5Yiw5YWo5bGA5pWw5o2u55qE6aKE5aSE55CGXHJcbiAgICAgKiBAcGFyYW0gR2xvYmFsVG9TZWxmUHJlUHJvY2VzcyDlhajlsYDmlbDmja7liLDoh6rouqvmlbDmja7nmoTpooTlpITnkIZcclxuICAgICAqL1xyXG4gICAgcHVibGljIEJpbmRHbG9iYWxUd29XYXk8U2VsZkRhdGFULCBHbG9iYWxEYXRhVCwgVCBleHRlbmRzIFBhZ2VEYXRhPihcclxuICAgICAgICBTZWxmRGF0YUtleToga2V5b2YgVCxcclxuICAgICAgICBHbG9iYWxEYXRhT2JqOiBEYXRhPEdsb2JhbERhdGFUPixcclxuICAgICAgICBTZWxmVG9HbG9iYWxQcmVQcm9jZXNzPzogKHZhbHVlOiBTZWxmRGF0YVQpID0+IEdsb2JhbERhdGFULFxyXG4gICAgICAgIEdsb2JhbFRvU2VsZlByZVByb2Nlc3M/OiAodmFsdWU6IEdsb2JhbERhdGFUKSA9PiBTZWxmRGF0YVQpIHtcclxuICAgICAgICB0aGlzLkJpbmRHbG9iYWw8R2xvYmFsRGF0YVQsIFQ+KEdsb2JhbERhdGFPYmosIFNlbGZEYXRhS2V5LCBHbG9iYWxUb1NlbGZQcmVQcm9jZXNzKTtcclxuICAgICAgICB0aGlzLkJpbmRHbG9iYWxCYWNrd2FyZDxTZWxmRGF0YVQsIFQ+KFNlbGZEYXRhS2V5LCBHbG9iYWxEYXRhT2JqLCBTZWxmVG9HbG9iYWxQcmVQcm9jZXNzKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBSZWdpc3RlcmVkU2VsZkJpbmRpbmc6IFJlY29yZDxzdHJpbmcsIEFycmF5PE9ic2VydmVyVGFyZ2V0PGFueT4+PiA9IHt9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog6aG16Z2i5pWw5o2u6Ieq57uR5a6aXHJcbiAgICAgKiBAdHlwZSB7U3JjRGF0YVR9IOa6kOaVsOaNruexu+Wei1xyXG4gICAgICogQHR5cGUge1R9IOmhtemdouS4rea0vueUn+iHqlBhZ2VEYXRh55qEZGF0Yeexu+Wei1xyXG4gICAgICogQHBhcmFtIFNyY0tleSDmupDmlbDmja5LZXlcclxuICAgICAqIEBwYXJhbSBUYXJnZXRLZXkg55uu5qCH5pWw5o2uS2V5XHJcbiAgICAgKiBAcGFyYW0gUHJlUHJvY2VzcyDpooTlpITnkIbmlrnlvI9cclxuICAgICAqL1xyXG4gICAgcHVibGljIEJpbmRTZWxmPFNyY0RhdGFULCBUIGV4dGVuZHMgUGFnZURhdGE+KFNyY0tleToga2V5b2YgVCwgVGFyZ2V0S2V5OiBrZXlvZiBULCBQcmVQcm9jZXNzPzogKHZhbHVlOiBTcmNEYXRhVCkgPT4gYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLlJlZ2lzdGVyZWRTZWxmQmluZGluZ1tTcmNLZXkgYXMgc3RyaW5nXSkge1xyXG4gICAgICAgICAgICB0aGlzLlJlZ2lzdGVyZWRTZWxmQmluZGluZ1tTcmNLZXkgYXMgc3RyaW5nXSA9IG5ldyBBcnJheTxPYnNlcnZlclRhcmdldDxhbnk+PigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLlJlZ2lzdGVyZWRTZWxmQmluZGluZ1tTcmNLZXkgYXMgc3RyaW5nXS5wdXNoKHtcclxuICAgICAgICAgICAgbmFtZTogVGFyZ2V0S2V5IGFzIHN0cmluZyxcclxuICAgICAgICAgICAgUHJlUHJvY2VzczogUHJlUHJvY2Vzc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgbGV0IFJlbmRlckRhdGE6UmVjb3JkPHN0cmluZyxhbnk+ID0ge307XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgUmVuZGVyRGF0YVtTcmNLZXkgYXMgc3RyaW5nXSA9IHRoaXMuZGF0YVtTcmNLZXldXHJcbiAgICAgICAgdGhpcy5SZW5kZXI8YW55PihSZW5kZXJEYXRhKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gRmlyc3REYXRhIERhdGExXHJcbiAgICAgKiBAcGFyYW0gU2VjRGF0YSBEYXRhMlxyXG4gICAgICogQHBhcmFtIEZpcnN0VG9TZWNQcmVQcm9jZXNzIERhdGEx5YiwRGF0YTLnmoTpooTlpITnkIZcclxuICAgICAqIEBwYXJhbSBTZWNUb0ZpcnN0UHJlUHJvY2VzcyBEYXRhMuWIsERhdGEx55qE6aKE5aSE55CGXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBCaW5kU2VsZlR3b1dheTxGaXJzdERhdGFULCBTZWNEYXRhVCwgVCBleHRlbmRzIFBhZ2VEYXRhPihcclxuICAgICAgICBGaXJzdERhdGE6IGtleW9mIFQsXHJcbiAgICAgICAgU2VjRGF0YToga2V5b2YgVCxcclxuICAgICAgICBGaXJzdFRvU2VjUHJlUHJvY2Vzcz86ICh2YWx1ZTogRmlyc3REYXRhVCkgPT4gU2VjRGF0YVQsXHJcbiAgICAgICAgU2VjVG9GaXJzdFByZVByb2Nlc3M/OiAodmFsdWU6IFNlY0RhdGFUKSA9PiBGaXJzdERhdGFUXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLkJpbmRTZWxmPEZpcnN0RGF0YVQsIFQ+KEZpcnN0RGF0YSwgU2VjRGF0YSwgRmlyc3RUb1NlY1ByZVByb2Nlc3MpO1xyXG4gICAgICAgIHRoaXMuQmluZFNlbGY8U2VjRGF0YVQsIFQ+KFNlY0RhdGEsIEZpcnN0RGF0YSwgU2VjVG9GaXJzdFByZVByb2Nlc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBSZW5kZXI8VCBleHRlbmRzIFBhZ2VEYXRhPih2YWx1ZTogUGFydGlhbDxSZWNvcmQ8a2V5b2YgVCwgYW55Pj4pIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXI8VD4odmFsdWUsIGZhbHNlKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBSZW5kZXJOb0JhY2t3YXJkPFQgZXh0ZW5kcyBQYWdlRGF0YT4odmFsdWU6IFBhcnRpYWw8UmVjb3JkPGtleW9mIFQsIGFueT4+KSB7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyPFQ+KHZhbHVlLCB0cnVlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBDb21wb25lbnREYXRhS2V5UGFpcjpSZWNvcmQ8c3RyaW5nLHtrZXk6c3RyaW5nLENvbXBJbnN0OlBlc3Vkb0NvbXBuZW50fT4gPSB7fTtcclxuICAgIHByaXZhdGUgX3JlbmRlcjxUIGV4dGVuZHMgUGFnZURhdGE+KHZhbHVlOiBQYXJ0aWFsPFJlY29yZDxrZXlvZiBULCBhbnk+PiwgRGlzYWJsZUJhY2t3YXJkOiBib29sZWFuKSB7XHJcbiAgICAgICAgbGV0IE1vZGlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IEtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcclxuICAgICAgICB0eXBlIERhdGFLZXlzID0ga2V5b2YgVDtcclxuICAgICAgICBLZXlzLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgaWYodGhpcy5Db21wb25lbnREYXRhS2V5UGFpcltrZXldKXtcclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5Db21wb25lbnREYXRhS2V5UGFpcltrZXldLkNvbXBJbnN0LmRhdGFbdGhpcy5Db21wb25lbnREYXRhS2V5UGFpcltrZXldLmtleV09dmFsdWVba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5SZWdpc3RlcmVkU2VsZkJpbmRpbmdba2V5XSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5SZWdpc3RlcmVkU2VsZkJpbmRpbmdba2V5XS5mb3JFYWNoKCh0YXJnZXQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoS2V5cy5pbmRleE9mKHRhcmdldC5uYW1lIGFzIHN0cmluZykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5QcmVQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVt0YXJnZXQubmFtZSBhcyBEYXRhS2V5c10gPSB0YXJnZXQuUHJlUHJvY2Vzcyh2YWx1ZVtrZXkgYXMgRGF0YUtleXNdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlW3RhcmdldC5uYW1lIGFzIERhdGFLZXlzXSA9IHZhbHVlW2tleSBhcyBEYXRhS2V5c107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghRGlzYWJsZUJhY2t3YXJkICYmIHRoaXMuUmVnaXN0ZXJlZEdsb2JhbEJhY2tXYXJkQmluZGluZ1trZXldKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlJlZ2lzdGVyZWRHbG9iYWxCYWNrV2FyZEJpbmRpbmdba2V5XS5mb3JFYWNoKHRhcmdldCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LlRhcmdldERhdGFPYmouU2V0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuUHJlUHJvY2VzcyA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuUHJlUHJvY2Vzcyh2YWx1ZVtrZXkgYXMgRGF0YUtleXNdKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVtrZXkgYXMgRGF0YUtleXNdKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoTW9kaWZpZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyPFQ+KHZhbHVlLCBEaXNhYmxlQmFja3dhcmQpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0RGF0YSh2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgcHJvdGVjdGVkIExvYWRQZXN1ZG9Db21wb25lbnRzKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBCYXNlRnVuY3Rpb25zID0gT2JqZWN0LmtleXModGhpcyk7XHJcbiAgICAgICAgbGV0IGNvbXBvbmVudHMgPSB0aGlzLlBlc3Vkb0NvbXBuZW50cyBhcyBSZWNvcmQ8c3RyaW5nLCBQZXN1ZG9Db21wbmVudD47XHJcbiAgICAgICAgT2JqZWN0LmtleXMoY29tcG9uZW50cykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgQ29tcCA9IGNvbXBvbmVudHNba2V5XTtcclxuICAgICAgICAgICAgQ29tcC5QYWdlSW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgICAgICBDb21wLl9yZW5kZXIgPSB0aGlzLlJlbmRlci5iaW5kKHRoaXMpO1xyXG4gICAgICAgICAgICBsZXQgQ29tcFByb3RvID0gQ29tcDtcclxuICAgICAgICAgICAgbGV0IENvbXBJZCA9IGNvbXBvbmVudHNba2V5XS5Db21wb25lbnRJZDtcclxuICAgICAgICAgICAgd2hpbGUgKENvbXBQcm90bykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoQ29tcFByb3RvKS5mb3JFYWNoKGtleSA9PiB7IFxyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKEJhc2VGdW5jdGlvbnMuaW5kZXhPZihrZXkpIDwgMCApIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIENvbXBQcm90b1trZXldID09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW0NvbXBJZCArIGtleV0gPSBDb21wUHJvdG9ba2V5XS5iaW5kKENvbXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIENvbXBQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihDb21wUHJvdG8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBDb21wRGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xyXG4gICAgICAgICAgICB2YXIgTWFwcGluZ0NvbXBEYXRhID0ge31cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvbXBvbmVudHNba2V5XS5kYXRhKS5mb3JFYWNoKGRhdGFrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICBDb21wRGF0YVtDb21wSWQgKyBkYXRha2V5XSA9IGNvbXBvbmVudHNba2V5XS5kYXRhW2RhdGFrZXldO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5Db21wb25lbnREYXRhS2V5UGFpcltDb21wSWQgKyBkYXRha2V5XT17XHJcbiAgICAgICAgICAgICAgICAgICAga2V5OiBkYXRha2V5LFxyXG4gICAgICAgICAgICAgICAgICAgIENvbXBJbnN0OmNvbXBvbmVudHNba2V5XVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAvLyBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWFwcGluZ0NvbXBEYXRhLCBkYXRha2V5LCB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgZ2V0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5kYXRhW0NvbXBJZCArIGRhdGFrZXldO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgc2V0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLmRhdGFbQ29tcElkICsgZGF0YWtleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICB9LFxyXG4gICAgICAgICAgICAgICAgLy8gICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAvL2NvbXBvbmVudHNba2V5XS5kYXRhID0gTWFwcGluZ0NvbXBEYXRhO1xyXG4gICAgICAgICAgICB0aGlzLlJlbmRlcihDb21wRGF0YSk7XHJcbiAgICAgICAgICAgIENvbXAuSW5pdCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIERhdGFDaGFuZ2UoZTpJdWlPcHRpb24pe1xyXG4gICAgICAgIGxldCBtb2RlbCA9IGUgYXMgRGF0YUNoYW5nZU9wdGlvbjtcclxuICAgICAgICBsZXQgcGF0aCA9IG1vZGVsLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5rZXkuc3BsaXQoXCIuXCIpO1xyXG4gICAgICAgIGxldCBkYXRhOlJlY29yZDxzdHJpbmcsYW55PiA9IHt9XHJcbiAgICAgICAgbGV0IHJvb3QgPSBkYXRhO1xyXG4gICAgICAgIGZvcihsZXQgaT0wO2k8cGF0aC5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgaWYoaT09cGF0aC5sZW5ndGgtMSl7XHJcbiAgICAgICAgICAgICAgICBkYXRhW3BhdGhbaV1dPW1vZGVsLmRldGFpbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhW3BhdGhbaV1dPT1cIm51bWJlclwiKXtcclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgZGF0YVtwYXRoW2ldXT1OdW1iZXIodGhpcy5kYXRhW3BhdGhbaV1dKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIGRhdGFbcGF0aFtpXV09dGhpcy5kYXRhW3BhdGhbaV1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRhdGE9ZGF0YVtwYXRoW2ldXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5SZW5kZXIocm9vdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIExvYWRFeHRlbmRzKCkge1xyXG4gICAgICAgIHRoaXMuRnVuYy5QYWdlSW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuRnVuYy5Jbml0KCk7XHJcbiAgICAgICAgdGhpcy5VSS5QYWdlSW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuVUkuSW5pdCgpO1xyXG4gICAgICAgIHRoaXMuVUkuSW5pdEN1c3RvbURhdGEoKTtcclxuICAgICAgICB0aGlzLkZ1bmMuSW5pdEN1c3RvbURhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgSW5QYXJhbWV0ZXI6IGFueVxyXG5cclxuICAgIHB1YmxpYyBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5JblBhcmFtZXRlciA9IFJvdXRlci5OYXZpZ2F0ZVBhcmFtO1xyXG4gICAgICAgIFJvdXRlci5QYWdlTG9hZCh0aGlzKTtcclxuICAgICAgICBpZiAodGhpcy5Mb2FkZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5Mb2FkZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5Mb2FkUGVzdWRvQ29tcG9uZW50cygpO1xyXG4gICAgICAgIHRoaXMuTG9hZEV4dGVuZHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25VbmxvYWQoKSB7XHJcbiAgICAgICAgUm91dGVyLlBhZ2VVbmxvYWQoKTtcclxuICAgIH1cclxufTsiXX0=