"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AsyncGroup = exports.Task = exports.printCallStack = exports.TaskGroup = exports.SaveCookies = exports.ParseCookie = exports.CreateRecordInstance = exports.List = exports.Guid = exports.nameof = exports.KeyValuePair = void 0;
var Storage_Config_1 = require("../Config/StorageConfig/Storage.Config");
var KeyValuePair = (function () {
    function KeyValuePair(_key, _value) {
        this.Key = _key;
        this.Value = _value;
    }
    return KeyValuePair;
}());
exports.KeyValuePair = KeyValuePair;
var nameof = function (name) { return name; };
exports.nameof = nameof;
var Guid = (function () {
    function Guid(value) {
        this.value = this.empty;
        if (value) {
            if (Guid.isValid(value)) {
                this.value = value;
            }
        }
    }
    Guid.newGuid = function () {
        return new Guid('xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0;
            var v = (c == 'x') ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        }));
    };
    Object.defineProperty(Guid, "empty", {
        get: function () {
            return '00000000-0000-0000-0000-000000000000';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Guid.prototype, "empty", {
        get: function () {
            return Guid.empty;
        },
        enumerable: false,
        configurable: true
    });
    Guid.isValid = function (str) {
        var validRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        return validRegex.test(str);
    };
    Guid.prototype.toString = function () {
        return this.value;
    };
    Guid.prototype.toJSON = function () {
        return this.value;
    };
    return Guid;
}());
exports.Guid = Guid;
var List = (function () {
    function List() {
    }
    List.Insert = function (src, item, index) {
        src.splice(index, 0, item);
        return src;
    };
    List.Remove = function (src, index) {
        src.splice(index, 1);
        return src;
    };
    List.Add = function (src, item) {
        src.push(item);
        return src;
    };
    return List;
}());
exports.List = List;
function CreateRecordInstance(instance) {
    var ResRecord = {};
    var Proto = instance;
    while (Proto) {
        Object.keys(Proto).map(function (key) {
            if (!ResRecord[key]) {
                if (typeof Proto[key] === 'function') {
                    ResRecord[key] = Proto[key].bind(instance);
                }
                else {
                }
            }
        });
        Proto = Object.getPrototypeOf(Proto);
    }
    return ResRecord;
}
exports.CreateRecordInstance = CreateRecordInstance;
function ParseCookie(cookieStr) {
    var cookieStrArr = cookieStr.split('=');
    var key = cookieStrArr[0];
    var value = cookieStrArr[1].split(';')[0];
    return new KeyValuePair(key, value);
}
exports.ParseCookie = ParseCookie;
function SaveCookies(NewCookies) {
    if (NewCookies.length > 0) {
        var cookiesMap = {};
        if (wx.getStorageSync(Storage_Config_1.StorageKey.Cookies)) {
            cookiesMap = JSON.parse(wx.getStorageSync(Storage_Config_1.StorageKey.Cookies));
        }
        for (var i = 0; i < NewCookies.length; i++) {
            var cookie = ParseCookie(NewCookies[i]);
            cookiesMap[cookie.Key] = cookie.Value;
        }
        wx.setStorageSync(Storage_Config_1.StorageKey.Cookies, JSON.stringify(cookiesMap));
    }
}
exports.SaveCookies = SaveCookies;
var TaskGroup = (function () {
    function TaskGroup() {
        this.TaskArray = new Array();
        this.CompleteCounter = 0;
    }
    TaskGroup.prototype.Add = function (task) {
        this.TaskArray.push(task);
    };
    TaskGroup.prototype.Run = function () {
        var _this = this;
        var task = new Task(function () {
            _this.TaskArray.forEach(function (value) {
                value.ContinueWith(function () {
                    _this.CompleteCounter++;
                    if (_this.CompleteCounter == _this.TaskArray.length - 1) {
                        task.Continue(_this.TaskArray);
                    }
                }).Run();
            });
        });
        return task;
    };
    return TaskGroup;
}());
exports.TaskGroup = TaskGroup;
function printCallStack() {
    var i = 0;
    var fun = arguments.callee;
    do {
        fun = fun.arguments.callee.caller;
        console.log(++i + ': ' + fun);
    } while (fun);
}
exports.printCallStack = printCallStack;
var Task = (function () {
    function Task(action, _IsCallbackTask) {
        var _this = this;
        this.IsCallbackTask = false;
        this.Run = function () {
            if (_this.Action) {
                var ActionResult = _this.Action(_this);
                if (ActionResult) {
                    _this.Result = ActionResult;
                }
            }
            if (!_this.IsCallbackTask) {
                _this._continue();
            }
            return _this;
        };
        this.Action = action;
        this.IsCallbackTask = _IsCallbackTask ? _IsCallbackTask : false;
        this.Root = this;
    }
    Task.Run = function (action) {
        var task = new Task(action);
        return task.Run();
    };
    Task.prototype._continue = function (result) {
        if (result) {
            this.Result = result;
        }
        if (this.ContinueAction) {
            var ContinueResult = this.ContinueAction(this.Result, this.NextTask);
            this.NextTask.Result = ContinueResult;
            if (!this.NextTask.IsCallbackTask) {
                this.NextTask._continue();
            }
        }
        return this;
    };
    Task.prototype.Continue = function (result) {
        this.IsCallbackTask = true;
        return this._continue(result);
    };
    Task.prototype.ContinueWith = function (Action, _IsCallbackTask) {
        this.ContinueAction = Action;
        this.NextTask = new Task();
        this.NextTask.Root = this.Root;
        this.NextTask.IsCallbackTask = _IsCallbackTask ? _IsCallbackTask : false;
        this.NextTask.Run = this.Root.Run.bind(this.Root);
        return this.NextTask;
    };
    Task.PrintFlow = function (task) {
        var root = task.Root;
        var currentTask = root;
        while (currentTask) {
            currentTask = currentTask.NextTask;
        }
    };
    return Task;
}());
exports.Task = Task;
var AsyncGroup = (function () {
    function AsyncGroup(_asyncFuncMap) {
        this.ResultMap = new Map();
        this.lock = false;
        this.AsyncFuncMap = _asyncFuncMap;
        this.CompletedCnt = this.AsyncFuncMap.size;
    }
    AsyncGroup.prototype.Run = function () {
        var _this = this;
        this.AsyncFuncMap.forEach(function (func, key) {
            func(function (result) {
                _this.ResultMap.set(key, result);
                _this.CheckComplete();
            });
        });
        return this;
    };
    AsyncGroup.prototype.ContinueWith = function (callback) {
        this.Complete = callback;
        return this;
    };
    AsyncGroup.prototype.CheckComplete = function () {
        while (this.lock) { }
        this.lock = true;
        this.CompletedCnt--;
        if (this.CompletedCnt == 0) {
            this.Complete(this.ResultMap);
        }
        this.lock = false;
    };
    return AsyncGroup;
}());
exports.AsyncGroup = AsyncGroup;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5RUFBb0U7QUFFcEU7SUFHSSxzQkFBWSxJQUFTLEVBQUUsTUFBVztRQUM5QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztJQUN4QixDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBUEQsSUFPQztBQVBZLG9DQUFZO0FBU2xCLElBQU0sTUFBTSxHQUFHLFVBQUksSUFBYSxJQUFLLE9BQUEsSUFBSSxFQUFKLENBQUksQ0FBQztBQUFwQyxRQUFBLE1BQU0sVUFBOEI7QUFFakQ7SUFtQkksY0FBWSxLQUFjO1FBRGxCLFVBQUssR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBRS9CLElBQUksS0FBSyxFQUFFO1lBQ1AsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQzthQUN0QjtTQUNKO0lBQ0wsQ0FBQztJQXhCYSxZQUFPLEdBQXJCO1FBQ0ksT0FBTyxJQUFJLElBQUksQ0FBQyxzQ0FBc0MsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLFVBQUEsQ0FBQztZQUNyRSxJQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqQyxJQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDM0MsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDO0lBQ0Qsc0JBQWtCLGFBQUs7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QWEsR0FBckI7UUFDSSxPQUFPLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRztRQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsRUFBRTtZQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtTQUNoQztRQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFDTCxpQkFBQztBQUFELENBQUMsQUF0Q0QsSUFzQ0M7QUF0Q1ksZ0NBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdG9yYWdlS2V5IH0gZnJvbSBcIi4uL0NvbmZpZy9TdG9yYWdlQ29uZmlnL1N0b3JhZ2UuQ29uZmlnXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgS2V5VmFsdWVQYWlyPFRfSywgVF9WPntcclxuICAgIHB1YmxpYyBLZXk6IFRfSztcclxuICAgIHB1YmxpYyBWYWx1ZTogVF9WO1xyXG4gICAgY29uc3RydWN0b3IoX2tleTogVF9LLCBfdmFsdWU6IFRfVikge1xyXG4gICAgICAgIHRoaXMuS2V5ID0gX2tleTtcclxuICAgICAgICB0aGlzLlZhbHVlID0gX3ZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbmFtZW9mID0gPFQ+KG5hbWU6IGtleW9mIFQpID0+IG5hbWU7XHJcblxyXG5leHBvcnQgY2xhc3MgR3VpZCB7XHJcbiAgICBwdWJsaWMgc3RhdGljIG5ld0d1aWQoKTogR3VpZCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBHdWlkKCd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgYyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwO1xyXG4gICAgICAgICAgICBjb25zdCB2ID0gKGMgPT0gJ3gnKSA/IHIgOiAociAmIDB4MyB8IDB4OCk7XHJcbiAgICAgICAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGdldCBlbXB0eSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAnMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwJztcclxuICAgIH1cclxuICAgIHB1YmxpYyBnZXQgZW1wdHkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gR3VpZC5lbXB0eTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgaXNWYWxpZChzdHI6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkUmVnZXggPSAvXlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9JC9pO1xyXG4gICAgICAgIHJldHVybiB2YWxpZFJlZ2V4LnRlc3Qoc3RyKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdmFsdWU6IHN0cmluZyA9IHRoaXMuZW1wdHk7XHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZT86IHN0cmluZykge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAoR3VpZC5pc1ZhbGlkKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIHRvU3RyaW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB0b0pTT04oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIExpc3Qge1xyXG4gICAgcHVibGljIHN0YXRpYyBJbnNlcnQ8VD4oc3JjOiBBcnJheTxUPiwgaXRlbTogVCwgaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHNyYy5zcGxpY2UoaW5kZXgsIDAsIGl0ZW0pO1xyXG4gICAgICAgIHJldHVybiBzcmM7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIFJlbW92ZTxUPihzcmM6IEFycmF5PFQ+LCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgc3JjLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgcmV0dXJuIHNyYztcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgQWRkPFQ+KHNyYzogQXJyYXk8VD4sIGl0ZW06IFQpIHtcclxuICAgICAgICBzcmMucHVzaChpdGVtKTtcclxuICAgICAgICByZXR1cm4gc3JjO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gQ3JlYXRlUmVjb3JkSW5zdGFuY2UoaW5zdGFuY2U6IGFueSkge1xyXG4gICAgbGV0IFJlc1JlY29yZDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XHJcbiAgICB0eXBlIEtfVCA9IGtleW9mIHR5cGVvZiBpbnN0YW5jZTtcclxuICAgIGxldCBQcm90byA9IGluc3RhbmNlO1xyXG4gICAgd2hpbGUgKFByb3RvKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoUHJvdG8pLm1hcChrZXkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIVJlc1JlY29yZFtrZXldKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIFByb3RvW2tleSBhcyBLX1RdID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgUmVzUmVjb3JkW2tleV0gPSAoUHJvdG9ba2V5IGFzIEtfVF0gYXMgRnVuY3Rpb24pLmJpbmQoaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1Jlc1JlY29yZFtrZXldID0gUHJvdG9ba2V5IGFzIEtfVF1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoUHJvdG8pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFJlc1JlY29yZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFBhcnNlQ29va2llKGNvb2tpZVN0cjogc3RyaW5nKTogS2V5VmFsdWVQYWlyPHN0cmluZywgc3RyaW5nPiB7XHJcbiAgICBsZXQgY29va2llU3RyQXJyOiBzdHJpbmdbXSA9IGNvb2tpZVN0ci5zcGxpdCgnPScpO1xyXG4gICAgbGV0IGtleTogc3RyaW5nID0gY29va2llU3RyQXJyWzBdO1xyXG4gICAgbGV0IHZhbHVlOiBzdHJpbmcgPSBjb29raWVTdHJBcnJbMV0uc3BsaXQoJzsnKVswXTtcclxuICAgIHJldHVybiBuZXcgS2V5VmFsdWVQYWlyPHN0cmluZywgc3RyaW5nPihrZXksIHZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFNhdmVDb29raWVzKE5ld0Nvb2tpZXM6IHN0cmluZ1tdKSB7XHJcbiAgICBpZiAoTmV3Q29va2llcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IGNvb2tpZXNNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcclxuICAgICAgICBpZiAod3guZ2V0U3RvcmFnZVN5bmMoU3RvcmFnZUtleS5Db29raWVzKSkge1xyXG4gICAgICAgICAgICBjb29raWVzTWFwID0gSlNPTi5wYXJzZSh3eC5nZXRTdG9yYWdlU3luYyhTdG9yYWdlS2V5LkNvb2tpZXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOZXdDb29raWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBjb29raWU6IEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4gPSBQYXJzZUNvb2tpZShOZXdDb29raWVzW2ldKTtcclxuICAgICAgICAgICAgY29va2llc01hcFtjb29raWUuS2V5XSA9IGNvb2tpZS5WYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoU3RvcmFnZUtleS5Db29raWVzLCBKU09OLnN0cmluZ2lmeShjb29raWVzTWFwKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUYXNrR3JvdXAge1xyXG4gICAgcHVibGljIFRhc2tBcnJheTogQXJyYXk8VGFzazxhbnk+PiA9IG5ldyBBcnJheTxUYXNrPGFueT4+KCk7XHJcbiAgICBwcml2YXRlIENvbXBsZXRlQ291bnRlciA9IDA7XHJcbiAgICBwdWJsaWMgQWRkKHRhc2s6IFRhc2s8YW55Pikge1xyXG4gICAgICAgIHRoaXMuVGFza0FycmF5LnB1c2godGFzayk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFJ1bigpOiBUYXNrPEFycmF5PFRhc2s8YW55Pj4+IHtcclxuICAgICAgICBsZXQgdGFzayA9IG5ldyBUYXNrPEFycmF5PFRhc2s8YW55Pj4+KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5UYXNrQXJyYXkuZm9yRWFjaCgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlLkNvbnRpbnVlV2l0aCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Db21wbGV0ZUNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5Db21wbGV0ZUNvdW50ZXIgPT0gdGhpcy5UYXNrQXJyYXkubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrLkNvbnRpbnVlKHRoaXMuVGFza0FycmF5KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5SdW4oKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGFzaztcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmludENhbGxTdGFjaygpIHtcclxuICAgIHZhciBpID0gMDtcclxuICAgIHZhciBmdW4gPSBhcmd1bWVudHMuY2FsbGVlO1xyXG4gICAgZG8ge1xyXG4gICAgICAgIGZ1biA9IGZ1bi5hcmd1bWVudHMuY2FsbGVlLmNhbGxlcjtcclxuICAgICAgICBjb25zb2xlLmxvZygrK2kgKyAnOiAnICsgZnVuKTtcclxuICAgIH0gd2hpbGUgKGZ1bik7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgVGFzazxSZXN1bHRUID0gdm9pZD57XHJcbiAgICBwcm90ZWN0ZWQgQ29udGludWVBY3Rpb24/OiAocmVzdWx0OiBSZXN1bHRULCB0YXNrOiBUYXNrPGFueT4pID0+IGFueTtcclxuICAgIHB1YmxpYyBSZXN1bHQhOiBSZXN1bHRUO1xyXG4gICAgcHVibGljIElzQ2FsbGJhY2tUYXNrOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcm90ZWN0ZWQgUm9vdDogVGFzazxhbnk+O1xyXG4gICAgcHJvdGVjdGVkIEFjdGlvbj86ICh0YXNrOiBUYXNrPFJlc3VsdFQ+KSA9PiBSZXN1bHRUIHwgdm9pZDtcclxuICAgIHByb3RlY3RlZCBOZXh0VGFzayE6IFRhc2s8YW55PjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhY3Rpb24/OiAodGFzazogVGFzazxSZXN1bHRUPikgPT4gUmVzdWx0VCB8IHZvaWQsIF9Jc0NhbGxiYWNrVGFzaz86IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLkFjdGlvbiA9IGFjdGlvbjtcclxuICAgICAgICB0aGlzLklzQ2FsbGJhY2tUYXNrID0gX0lzQ2FsbGJhY2tUYXNrID8gX0lzQ2FsbGJhY2tUYXNrIDogZmFsc2U7XHJcbiAgICAgICAgdGhpcy5Sb290ID0gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgUnVuOiAoKSA9PiBUYXNrPFJlc3VsdFQ+ID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLkFjdGlvbikge1xyXG4gICAgICAgICAgICBsZXQgQWN0aW9uUmVzdWx0ID0gdGhpcy5BY3Rpb24odGhpcyk7XHJcbiAgICAgICAgICAgIGlmIChBY3Rpb25SZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuUmVzdWx0ID0gQWN0aW9uUmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5Jc0NhbGxiYWNrVGFzaykge1xyXG4gICAgICAgICAgICB0aGlzLl9jb250aW51ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIFJ1bjxSZXN1bHRUPihhY3Rpb246ICh0YXNrOiBUYXNrPFJlc3VsdFQ+KSA9PiBSZXN1bHRUKTogVGFzazxSZXN1bHRUPiB7XHJcbiAgICAgICAgbGV0IHRhc2s6IFRhc2s8UmVzdWx0VD4gPSBuZXcgVGFzazxSZXN1bHRUPihhY3Rpb24pO1xyXG4gICAgICAgIHJldHVybiB0YXNrLlJ1bigpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBfY29udGludWUocmVzdWx0PzogUmVzdWx0VCk6IFRhc2s8UmVzdWx0VD4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgdGhpcy5SZXN1bHQgPSByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLkNvbnRpbnVlQWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGxldCBDb250aW51ZVJlc3VsdCA9IHRoaXMuQ29udGludWVBY3Rpb24odGhpcy5SZXN1bHQsIHRoaXMuTmV4dFRhc2spO1xyXG4gICAgICAgICAgICB0aGlzLk5leHRUYXNrLlJlc3VsdCA9IENvbnRpbnVlUmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuTmV4dFRhc2suSXNDYWxsYmFja1Rhc2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuTmV4dFRhc2suX2NvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIENvbnRpbnVlKHJlc3VsdD86IFJlc3VsdFQpOiBUYXNrPFJlc3VsdFQ+IHtcclxuICAgICAgICAvLyBpZiAoIXRoaXMuTmV4dFRhc2suSXNDYWxsYmFja1Rhc2spIHtcclxuICAgICAgICAvLyAgICAgY29uc29sZS53YXJuKHRoaXMuQ29udGludWVBY3Rpb24sIFwiWW91IGNhbGwgQ29udGludWUsYnV0IGhhcyBub3Qgc2V0IF9Jc0NhbGxiYWNrVGFzayBhcyB0cnVlXCIpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICB0aGlzLklzQ2FsbGJhY2tUYXNrPXRydWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRpbnVlKHJlc3VsdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIENvbnRpbnVlV2l0aDxDb250aW51ZVJlc3VsdCA9IHZvaWQ+KFxyXG4gICAgICAgIEFjdGlvbjogKHJlc3VsdDogUmVzdWx0VCwgdGFzazogVGFzazxDb250aW51ZVJlc3VsdD4pID0+IENvbnRpbnVlUmVzdWx0IHwgdm9pZCxcclxuICAgICAgICBfSXNDYWxsYmFja1Rhc2s/OiBib29sZWFuKVxyXG4gICAgICAgIDogVGFzazxDb250aW51ZVJlc3VsdD4ge1xyXG4gICAgICAgIHRoaXMuQ29udGludWVBY3Rpb24gPSBBY3Rpb247XHJcbiAgICAgICAgdGhpcy5OZXh0VGFzayA9IG5ldyBUYXNrPENvbnRpbnVlUmVzdWx0PigpO1xyXG4gICAgICAgIHRoaXMuTmV4dFRhc2suUm9vdCA9IHRoaXMuUm9vdDtcclxuICAgICAgICB0aGlzLk5leHRUYXNrLklzQ2FsbGJhY2tUYXNrID0gX0lzQ2FsbGJhY2tUYXNrID8gX0lzQ2FsbGJhY2tUYXNrIDogZmFsc2U7XHJcbiAgICAgICAgdGhpcy5OZXh0VGFzay5SdW4gPSB0aGlzLlJvb3QuUnVuLmJpbmQodGhpcy5Sb290KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5OZXh0VGFzaztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIFByaW50Rmxvdyh0YXNrOiBUYXNrPGFueT4pIHtcclxuICAgICAgICBsZXQgcm9vdCA9IHRhc2suUm9vdDtcclxuICAgICAgICBsZXQgY3VycmVudFRhc2sgPSByb290O1xyXG4gICAgICAgIHdoaWxlIChjdXJyZW50VGFzaykge1xyXG4gICAgICAgICAgICBjdXJyZW50VGFzayA9IGN1cnJlbnRUYXNrLk5leHRUYXNrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEFzeW5jR3JvdXAge1xyXG4gICAgcHJpdmF0ZSBBc3luY0Z1bmNNYXA6IE1hcDxzdHJpbmcsIChjYWxsYmFjazogKHJlc3VsdDogYW55KSA9PiB2b2lkKSA9PiBhbnk+XHJcbiAgICBwcml2YXRlIFJlc3VsdE1hcDogTWFwPHN0cmluZywgYW55PiA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICBwcml2YXRlIENvbXBsZXRlZENudDogbnVtYmVyO1xyXG5cclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgcHJpdmF0ZSBDb21wbGV0ZTogKHJlc3VsdDogTWFwPHN0cmluZywgYW55PikgPT4gdm9pZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihfYXN5bmNGdW5jTWFwOiBNYXA8c3RyaW5nLCAoY2FsbGJhY2s6IChyZXN1bHQ6IGFueSkgPT4gdm9pZCkgPT4gYW55Pikge1xyXG4gICAgICAgIHRoaXMuQXN5bmNGdW5jTWFwID0gX2FzeW5jRnVuY01hcDtcclxuICAgICAgICB0aGlzLkNvbXBsZXRlZENudCA9IHRoaXMuQXN5bmNGdW5jTWFwLnNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFJ1bigpOiBBc3luY0dyb3VwIHtcclxuICAgICAgICB0aGlzLkFzeW5jRnVuY01hcC5mb3JFYWNoKChmdW5jLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgZnVuYygocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlJlc3VsdE1hcC5zZXQoa2V5LCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5DaGVja0NvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIENvbnRpbnVlV2l0aChjYWxsYmFjazogKHJlc3VsdDogTWFwPHN0cmluZywgYW55PikgPT4gdm9pZCk6IEFzeW5jR3JvdXAge1xyXG4gICAgICAgIHRoaXMuQ29tcGxldGUgPSBjYWxsYmFjaztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvY2s6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgQ2hlY2tDb21wbGV0ZSgpIHtcclxuICAgICAgICB3aGlsZSAodGhpcy5sb2NrKSB7IH1cclxuICAgICAgICB0aGlzLmxvY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuQ29tcGxldGVkQ250LS07XHJcbiAgICAgICAgaWYgKHRoaXMuQ29tcGxldGVkQ250ID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5Db21wbGV0ZSh0aGlzLlJlc3VsdE1hcClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2NrID0gZmFsc2U7XHJcbiAgICB9XHJcbn0iXX0=